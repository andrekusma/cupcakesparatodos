<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Cupcakes Para Todos</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css">
</head>
<body class="bg-gray-900 text-gray-100 min-h-screen">
<div id="app" class="p-4 max-w-4xl mx-auto">
<h1 class="text-3xl font-bold text-center mb-6">Cupcakes Para Todos</h1>
<div id="loginSection" class="mb-6">
<input id="email" type="email" placeholder="E-mail" class="p-2 rounded text-black w-full mb-2">
<input id="password" type="password" placeholder="Senha" class="p-2 rounded text-black w-full mb-2">
<button id="loginBtn" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded w-full">Entrar</button>
<p id="loginError" class="text-red-500 mt-2 hidden"></p>
</div>
<div id="storeSection" class="hidden">
<p class="text-green-400 mb-4">Logado como <span id="userEmail"></span></p>
<div id="cupcakeList" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4"></div>
</div>
</div>


<script>
window.API_BASE = 'https://cupcakesparatodos.onrender.com';
let token = null;


async function login() {
const email = document.getElementById('email').value.trim();
const password = document.getElementById('password').value.trim();
const errorEl = document.getElementById('loginError');


if (!email || !password) {
errorEl.textContent = 'Por favor, preencha e-mail e senha.';
errorEl.classList.remove('hidden');
return;
}


try {
const res = await fetch(`${window.API_BASE}/api/auth/login`, {
method: 'POST',
headers: { 'Content-Type': 'application/json' },
body: JSON.stringify({ email, password })
});


if (!res.ok) {
const err = await res.json().catch(() => ({}));
throw new Error(err.message || 'Falha no login');
}


const data = await res.json();
token = data.token;
document.getElementById('userEmail').textContent = data.user.email;
document.getElementById('loginSection').classList.add('hidden');
document.getElementById('storeSection').classList.remove('hidden');
await loadCupcakes();
} catch (err) {
console.error('Erro no login:', err);
errorEl.textContent = err.message;
errorEl.classList.remove('hidden');
}
}


async function loadCupcakes() {
try {
const res = await fetch(`${window.API_BASE}/api/cupcakes`);
const cupcakes = await res.json();
const list = document.getElementById('cupcakeList');
list.innerHTML = '';
cupcakes.forEach(c => {
const div = document.createElement('div');
div.className = 'bg-gray-800 rounded shadow p-3';
div.innerHTML = `
<img src="${c.image_url || 'https://via.placeholder.com/150'}" class="w-full h-40 object-cover rounded mb-2">
<h2 class="text-xl font-bold">${c.nome}</h2>
<p class="text-gray-400">R$ ${(c.preco_cents/100).toFixed(2)}</p>
`;
list.appendChild(div);
});
} catch (err) {
console.error('Erro ao carregar cupcakes:', err);
}
}


document.getElementById('loginBtn').addEventListener('click', login);
</script>
</body>
</html>